<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>YouTube Channel Widget for Notion</title>
  <style>
    /* =============================================================
       DESIGN TOKENS (auto‑dark‑mode)                              
    ============================================================= */
    :root {
      --bg: #ffffff;
      --card: #ffffff;
      --text: #1e1e1e;
      --muted: #4b5563;
      --border: #e5e7eb;
    }
    body.dark {
      --bg: #18181b;
      --card: #1f2937;
      --text: #f3f4f6;
      --muted: #9ca3af;
      --border: #27272a;
    }

    /* =============================================================
       GLOBAL RESET                                                
    ============================================================= */
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: "Inter", system-ui, sans-serif;
      background: var(--bg);
      color: var(--text);
    }
    a { color: inherit; text-decoration: none; }

    /* =============================================================
       LAYOUT CONTAINER                                            
    ============================================================= */
    #widget {
      max-width: 740px;
      border: 1px solid var(--border);
      border-radius: 0.5rem;
      overflow: hidden;
      background: var(--card);
      box-shadow: 0 4px 10px rgba(0,0,0,0.06);
    }

    /* =============================================================
       HEADER (banner + meta)                                      
    ============================================================= */
    .banner{height:160px;background-size:cover;background-position:center;position:relative}
    .banner::after{content:"";position:absolute;inset:0;background:rgba(0,0,0,.35)}

    .channel-bar{display:flex;gap:1rem;padding:1rem;background:var(--card);border-bottom:1px solid var(--border)}
    .channel-thumb{width:72px;height:72px;border-radius:50%;object-fit:cover;border:2px solid var(--card);flex-shrink:0}
    .channel-title{font-size:1.25rem;font-weight:600;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;line-height:1.3}
    .channel-stats{font-size:.875rem;color:var(--muted)}

    /* --- collapsible description preview (3‑line clamp) --- */
    details.desc{margin-top:.5rem;font-size:.875rem;color:var(--muted)}
    details.desc>summary{list-style:none;cursor:pointer;position:relative;padding-right:1.2em;}
    details.desc>summary::-webkit-details-marker{display:none}
    details.desc>summary::after{content:"▲";position:absolute;right:0;top:0}
    details.desc[open]>summary::after{content:"▼"}
    .desc-preview{display:-webkit-box;-webkit-box-orient:vertical;-webkit-line-clamp:3;overflow:hidden;line-height:1.35;}
    details.desc[open] .desc-preview{-webkit-line-clamp:unset}

    /* =============================================================
       INLINE PLAYER                                               
    ============================================================= */
    .player-wrap{display:none;position:relative;background:#000;aspect-ratio:16/9}
    .player-wrap.active{display:block}
    .player-wrap iframe{width:100%;height:100%;border:0}
    .close-btn{position:absolute;top:6px;right:8px;background:rgba(0,0,0,0.5);color:#fff;border:0;border-radius:9999px;width:28px;height:28px;font-size:1rem;cursor:pointer}

    /* =============================================================
       SEARCH BAR                                                  
    ============================================================= */
    .search-wrap{display:flex;justify-content:flex-end;padding:.75rem 1rem .5rem}
    .search-input{padding:.4rem .75rem;border:1px solid var(--border);border-radius:.375rem;font-size:.875rem;background:var(--bg);color:var(--text)}

    /* =============================================================
       VIDEO LIST                                                  
    ============================================================= */
    .videos{padding:1rem}
    .video-item{display:flex;gap:.75rem;margin-bottom:1rem;cursor:pointer}
    .video-thumb{width:180px;aspect-ratio:16/9;object-fit:cover;border-radius:.25rem;flex-shrink:0}
    .video-title{font-weight:600;margin-bottom:.25rem;line-height:1.4}
    .video-stats{font-size:.75rem;color:var(--muted);margin-bottom:2px}
    .video-desc{font-size:.875rem;color:var(--muted);line-height:1.3}
  </style>
</head>
<body>
  <div id="widget">
    <!-- Banner -->
    <div class="banner" id="banner"></div>

    <!-- Channel meta -->
    <div class="channel-bar">
      <img class="channel-thumb" id="channelThumb" alt="thumb" />
      <div class="channel-meta">
        <div class="channel-title" id="channelTitle"></div>
        <div class="channel-stats" id="channelStats"></div>

        <!-- Collapsible description -->
        <details class="desc" id="channelDesc">
          <summary><span id="descPreview" class="desc-preview"></span></summary>
          <p id="channelDescFull"></p>
        </details>
      </div>
    </div>

    <!-- Inline player -->
    <div class="player-wrap" id="playerWrap">
      <button class="close-btn" id="closePlayer">×</button>
      <iframe id="playerFrame" allow="accelerometer;autoplay;clipboard-write;encrypted-media;gyroscope;picture-in-picture" allowfullscreen></iframe>
    </div>

    <!-- Search -->
    <div class="search-wrap"><input type="search" id="searchInput" class="search-input" placeholder="Search videos…"></div>

    <!-- Video list -->
    <div class="videos" id="videos"></div>
  </div>

  <script type="module">
    /******** CONFIG *********/
    const API_KEY    = "AIzaSyDT7go0eQEFqlAU_bc-xe398xT0I1_CCps";   // ← replace / restrict
    const CHANNEL_ID = "UCOPBWWtc27ePtGD4dcqIFmA"; // ← replace
    const MAX_RESULTS = 25;

    /******** UTILS *********/
    const $ = (s) => document.querySelector(s);
    const fmtNum = (n) => Number(n).toLocaleString();
    const fmtDate = (iso) => new Date(iso).toLocaleDateString(undefined,{year:"numeric",month:"short",day:"numeric"});
    const json = async (u)=>{const r=await fetch(u);if(!r.ok)throw new Error(await r.text());return r.json();};

    /******** DARK MODE AUTO *********/
    if (matchMedia('(prefers-color-scheme: dark)').matches) document.body.classList.add('dark');

    /******** MAIN *********/
    let allVideos=[];

    async function init(){
      try{
        const ch=(await json(`https://www.googleapis.com/youtube/v3/channels?part=snippet,statistics,brandingSettings,contentDetails&id=${CHANNEL_ID}&key=${API_KEY}`)).items[0];
        renderHeader(ch);

        const uploads=ch.contentDetails.relatedPlaylists.uploads;
        const items=(await json(`https://www.googleapis.com/youtube/v3/playlistItems?part=snippet,contentDetails&playlistId=${uploads}&maxResults=${MAX_RESULTS}&key=${API_KEY}`)).items;

        const ids=items.map(i=>i.contentDetails.videoId).join(',');
        const statsResp=await json(`https://www.googleapis.com/youtube/v3/videos?part=statistics,snippet&id=${ids}&key=${API_KEY}`);
        const stats=Object.fromEntries(statsResp.items.map(v=>[v.id,v]));

        allVideos=items.map(it=>{
          const v=stats[it.contentDetails.videoId];
          return{
            id:it.contentDetails.videoId,
            title:it.snippet.title,
            desc:it.snippet.description,
            thumb:it.snippet.thumbnails.medium.url,
            views:v?v.statistics.viewCount:0,
            date:v?v.snippet.publishedAt:it.contentDetails.videoPublishedAt
          };
        });
        paint(allVideos);
      }catch(e){console.error(e);$('#videos').innerHTML=`<p style="color:#ef4444;padding:1rem">${e.message}</p>`;}
    }

    function renderHeader(ch){
      $('#channelTitle').textContent=ch.snippet.title;
      $('#channelThumb').src=ch.snippet.thumbnails.high.url;
      $('#channelStats').textContent=`${fmtNum(ch.statistics.subscriberCount)} subscribers • ${fmtNum(ch.statistics.videoCount)} videos • ${fmtNum(ch.statistics.viewCount)} views`;
      const desc=ch.snippet.description||"";
      $('#descPreview').textContent=desc;
      $('#channelDescFull').textContent=desc;
      if(ch.brandingSettings?.image?.bannerExternalUrl){$('#banner').style.backgroundImage=`url(${ch.brandingSettings.image.bannerExternalUrl})`;}
    }

    function paint(list){
      const wrap=$('#videos');wrap.innerHTML="";
      list.forEach(v=>{
        const div=document.createElement('div');div.className='video-item';
        div.innerHTML=`<img loading="lazy" src="${v.thumb}" class="video-thumb" alt="${v.title}"><div class="video-meta"><div class="video-title">${v.title}</div><div class="video-stats">${fmtNum(v.views)} views • ${fmtDate(v.date)}</div><div class="video-desc">${(v.desc||"").slice(0,140)}…</div></div>`;
        div.addEventListener('click',()=>openPlayer(v.id));wrap.appendChild(div);
      });
    }

    function openPlayer(id){$('#playerFrame').src=`https://www.youtube.com/embed/${id}?autoplay=1`;$('#playerWrap').classList.add('active');$('#playerWrap').scrollIntoView({behavior:'smooth'});}
    $('#closePlayer').addEventListener('click',()=>{$('#playerWrap').classList.remove('active');$('#playerFrame').src="";});

    $('#searchInput').addEventListener('input',e=>{const q=e.target.value.toLowerCase();paint(allVideos.filter(v=>v.title.toLowerCase().includes(q)||v.desc.toLowerCase().includes(q)));});

    init();
  </script>
</body>
</html>
